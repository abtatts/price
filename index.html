<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <title>ab.tatts</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, "SF Pro Text", system-ui;
      margin: 0;
      padding: 16px;
      background: #111;
      color: #f5f5f5;
    }
    h1 {
      font-size: 20px;
      margin-bottom: 8px;
    }
    .sub {
      font-size: 12px;
      color: #aaa;
      margin-bottom: 16px;
    }
    .card {
      background: #1c1c1e;
      border-radius: 12px;
      padding: 12px 14px;
      margin-bottom: 14px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.4);
    }
    .card-title {
      font-size: 14px;
      font-weight: 600;
      margin-bottom: 6px;
    }
    label {
      display: block;
      font-size: 13px;
      margin-bottom: 4px;
    }
    input, select {
      width: 100%;
      box-sizing: border-box;
      padding: 8px 10px;
      border-radius: 8px;
      border: 1px solid #333;
      background: #000;
      color: #f5f5f5;
      font-size: 14px;
      margin-bottom: 8px;
    }
    input:focus, select:focus {
      outline: none;
      border-color: #4f8cff;
    }
    .row {
      display: flex;
      gap: 8px;
    }
    .row > div {
      flex: 1;
    }
    button {
      width: 100%;
      padding: 10px;
      border-radius: 10px;
      border: none;
      font-size: 16px;
      font-weight: 600;
      background: linear-gradient(135deg, #4f8cff, #7b5cff);
      color: #fff;
      margin-top: 4px;
    }
    button:active {
      transform: scale(0.98);
    }
    .result-main {
      font-size: 22px;
      font-weight: 700;
      margin-bottom: 4px;
    }
    .result-sub {
      font-size: 13px;
      color: #ccc;
      margin-bottom: 4px;
    }
    .result-detail {
      font-size: 12px;
      color: #999;
      line-height: 1.4;
      white-space: pre-line;
    }
    .badge {
      display: inline-block;
      font-size: 11px;
      padding: 2px 6px;
      border-radius: 999px;
      background: #333;
      margin-left: 4px;
      color: #ddd;
    }
    .small-note {
      font-size: 11px;
      color: #777;
    }
  </style>
</head>
<body>
  <h1>ab.tatts</h1>
  <div class="sub">
    公式參考：尺寸 × 80 ＋ 部位難度 / 施作 / 設計 × 300。
    若原始報價低於 2000，會提示加入開針費 1500 後的價格。
  </div>

  <!-- 基本資訊 -->
  <div class="card">
    <div class="card-title">基本資訊</div>
    <label>
      圖案名稱（選填）
      <input id="name" type="text" placeholder="例如：上胸水母..." />
    </label>

    <div class="row">
      <div>
        <label>長（cm）</label>
        <input id="length" type="number" inputmode="decimal" placeholder="可選填" />
      </div>
      <div>
        <label>寬（cm）</label>
        <input id="width" type="number" inputmode="decimal" placeholder="可選填" />
      </div>
    </div>

    <label>
      尺寸（面積，cm²）
      <input id="size" type="number" inputmode="decimal" placeholder="可手動填，或由長×寬帶入" />
    </label>

    <div class="small-note" id="areaHint" style="margin-top:-6px; margin-bottom:8px; color:#bbb; font-size:11px;">
      自動計算面積：0 cm²
    </div>

    <label>
      尺寸比例（% → 用小數，例如 0.6）
      <input id="percent" type="number" step="0.05" inputmode="decimal" value="0.6" />
    </label>
  </div>

  <!-- 難度與設計 -->
  <div class="card">
    <div class="card-title">
      難度與設計參數 <span class="badge">和 Excel 對應</span>
    </div>

    <label>
      部位難度（0～3 自訂）
      <select id="partDiff">
        <option value="0">0：一般</option>
        <option value="1">1：稍難</option>
        <option value="2">2：困難（例如背、大面積）</option>
        <option value="3">3：非常困難</option>
      </select>
    </label>

    <div class="row">
      <div>
        <label>複雜度（1~7 簡單線條、文字、煙霧水墨線、簡單物體、細節多、細節層次多、寫實）</label>
        <input id="complexity" type="number" inputmode="decimal" value="3" />
      </div>
      <div>
        <label>寫實度(1~5)</label>
        <input id="realism" type="number" inputmode="decimal" value="0" />
      </div>
    </div>

    <div class="row">
      <div>
        <label>色彩（三瓶內：1、3~6：2、>6：3）</label>
        <input id="color" type="number" inputmode="decimal" value="0" />
      </div>
      <div>
        <label>改圖（0~20）</label>
        <input id="redesign" type="number" inputmode="decimal" value="0" />
      </div>
    </div>

    <label>
      設計等級（1～8）
      <input id="design" type="number" inputmode="decimal" value="0" />
    </label>
    <div class="small-note">
      對應 Excel 的：施作合計 = 複雜度 + 寫實度 + 色彩 + 改圖。<br>
      尺寸面積調整 / 設計面積調整 會依「是否 &lt;150cm²」自動套公式。
    </div>
  </div>

  <!-- 常數設定（可微調） -->
  <div class="card">
    <div class="card-title">計算常數（可調整）</div>
    <div class="row">
      <div>
        <label>尺寸單價 B1（預設 80）</label>
        <input id="constB1" type="number" inputmode="decimal" value="80" />
      </div>
      <div>
        <label>尺寸門檻 D1（預設 150）</label>
        <input id="constD1" type="number" inputmode="decimal" value="150" />
      </div>
    </div>
    <div class="row">
      <div>
        <label>部位難度單價（預設 300）</label>
        <input id="constPart" type="number" inputmode="decimal" value="300" />
      </div>
      <div>
        <label>施作 / 設計單價（預設 300）</label>
        <input id="constDiff" type="number" inputmode="decimal" value="300" />
      </div>
    </div>
    <div class="small-note">
      這裡對應你 Excel 第一列的 80、150、300、300。
    </div>
  </div>

  <!-- 計算與結果 -->
  <div class="card">
    <button onclick="calculate()">計算報價</button>
  </div>

  <div class="card" id="resultCard" style="display:none;">
    <div class="card-title">計算結果</div>
    <div class="result-main" id="resultTotal"></div>
    <div class="result-sub" id="resultOpen"></div>
    <div class="result-sub" id="resultRounded"></div>
    <div class="result-sub" id="resultDeposit"></div>
    <div class="result-detail" id="resultDetail"></div>
  </div>

  <script>
    function num(id) {
      var v = parseFloat(document.getElementById(id).value);
      return isNaN(v) ? 0 : v;
    }

    function formatMoney(x) {
      // ✅ 這行之前我打錯，現在是正常可用的版本
      return x
        .toFixed(0)
        .replace(/\B(?=(\d{3})+(?!\d))/g, ",");
    }

    // 長 × 寬 → 自動帶入面積
    function updateAreaFromLengthWidth() {
      var length = num("length");
      var width  = num("width");
      var areaHint = document.getElementById("areaHint");

      if (length > 0 && width > 0) {
        var area = length * width;
        document.getElementById("size").value = area.toFixed(1);
        areaHint.textContent = "自動計算面積：" + area.toFixed(1) + " cm²";
      } else {
        areaHint.textContent = "自動計算面積：0 cm²";
      }
    }

    // 監聽長、寬輸入
    document.getElementById("length").addEventListener("input", updateAreaFromLengthWidth);
    document.getElementById("width").addEventListener("input", updateAreaFromLengthWidth);

    function calculate() {
      // 再保險一次長×寬
      updateAreaFromLengthWidth();

      var name      = document.getElementById("name").value || "未命名圖案";
      var size      = num("size");     // B
      var percent   = num("percent");  // C
      var partDiff  = num("partDiff");// E

      var complexity = num("complexity"); // G
      var realism    = num("realism");    // H
      var color      = num("color");      // I
      var redesign   = num("redesign");   // J
      var design     = num("design");     // K

      var B1         = num("constB1");    // 80
      var D1         = num("constD1");    // 150
      var unitPart   = num("constPart");  // 300
      var unitDiff   = num("constDiff");  // 300
      var unitDesign = num("constDiff");  // 同一個

      if (size <= 0 || percent <= 0) {
        alert("請至少填寫『尺寸』與『尺寸比例(%)』。");
        return;
      }

      // F = 複雜度 + 寫實度 + 色彩 + 改圖
      var totalDiff = complexity + realism + color + redesign;

      // 尺寸 / 設計面積調整
      var sizeAdj, designAdj;
      if (size < D1) {
        sizeAdj   = totalDiff;
        designAdj = design;
      } else {
        sizeAdj   = (size / D1) * totalDiff;
        designAdj = (size / D1) * design;
      }

      // 四個主構成
      var baseCost   = size * B1 * percent;
      var partCost   = partDiff * unitPart;
      var diffCost   = sizeAdj * unitDiff;
      var designCost = designAdj * unitDesign;

      // M：原始計算報價（未含開針費）
      var M = baseCost + partCost + diffCost + designCost;

      // 若低於 2000，加入開針費 1500 的參考價
      var openFee = 0;
      var openText = "";

      if (M > 0 && M < 2000) {
        openFee = 1500;
        openText =
          "若加入開針費 1500，金額為：$" +
          formatMoney(M + openFee) +
          "（低於 2000 建議加開針費）";
      } else {
        openText = "此案件原始報價已達 2000 以上，可視情況決定是否另收開針費。";
      }

      var total = M + openFee;
      var rounded = Math.round(total / 100) * 100;
      var deposit = Math.round(total * 0.3 / 100) * 100;

      document.getElementById("resultCard").style.display = "block";

      document.getElementById("resultTotal").textContent =
        "原始計算報價（未含開針費）：$" + formatMoney(M);

      document.getElementById("resultOpen").textContent = openText;

      document.getElementById("resultRounded").textContent =
        "（若含開針費）建議客人報價（四捨五入到百元）：$" +
        formatMoney(rounded);

      document.getElementById("resultDeposit").textContent =
        "建議訂金（約三成）：$" + formatMoney(deposit);

      var detail =
        "圖案名稱：" + name + "\n" +
        "尺寸：" + size.toFixed(1) + " cm²，比例：" + percent + "\n" +
        "部位難度：" + partDiff +
        "，複雜度：" + complexity +
        "，寫實度：" + realism +
        "，色彩：" + color +
        "，改圖：" + redesign + "\n" +
        "設計等級：" + design + "\n\n" +
        "尺寸費用：$" + formatMoney(baseCost) + "\n" +
        "部位加成：$" + formatMoney(partCost) + "\n" +
        "施作加成（尺寸面積調整）：$" + formatMoney(diffCost) + "\n" +
        "設計加成（設計面積調整）：$" + formatMoney(designCost) + "\n" +
        "開針費參考：" + (openFee > 0 ? "$" + formatMoney(openFee) : "無（可自由決定）");

      document.getElementById("resultDetail").textContent = detail;
    }
  </script>
</body>
</html>





